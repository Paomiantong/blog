---
slug: /how2usehusky
title: HuskyğŸ¶ä½¿ç”¨å°å¿ƒå¾—
date: 2024-06-23
---

import { Mark } from "@site/src/components/Extend";

æ ¹æ®[Huskyå®˜ç½‘æ–‡æ¡£](https://typicode.github.io/husky/get-started.html)ä¸€æ­¥ä¸€æ­¥å®‰è£…ä½¿ç”¨<Mark>HuskyğŸ¶</Mark>ï¼Œå¹¶æ·»åŠ `lint-staged`å’Œ`commit-lint`æ¥å®Œå–„Gitæäº¤å·¥ä½œæµã€‚
$--truncate--$

## å®‰è£…

ç¬¬ä¸€æ­¥ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…å®‰è£…Huskyï¼Œæˆ‘è¿™è¾¹ä½¿ç”¨çš„æ˜¯[pnpm](https://pnpm.io/)ã€‚

```sh
pnpm add --save-dev husky
```

## åˆå§‹åŒ–

:::tip
initå‘½ä»¤ç®€åŒ–äº†åœ¨é¡¹ç›®ä¸­è®¾ç½®huskyçš„è¿‡ç¨‹ã€‚å®ƒåœ¨.husty/ä¸­åˆ›å»ºäº†ä¸€ä¸ªé¢„æäº¤è„šæœ¬ï¼Œå¹¶åœ¨package.jsonä¸­æ›´æ–°äº†prepareè„šæœ¬ã€‚ç¨åå¯ä»¥è¿›è¡Œä¿®æ”¹ä»¥é€‚åº”æ‚¨çš„å·¥ä½œæµç¨‹ã€‚
:::
å®‰è£…å®Œæˆä¹‹åï¼Œæ‰§è¡Œ`husky init`å‘½ä»¤ï¼Œæ¥åˆå§‹åŒ–Huskyã€‚

```sh
pnpm exec husky init
```

åˆå§‹åŒ–ä¹‹åï¼Œç›®å½•ä¸‹ä¼šè‡ªåŠ¨ç”Ÿæˆ`.husky`æ–‡ä»¶å¤¹ï¼Œé‡Œæœ‰ä¸€ä¸ª`_`æ–‡ä»¶å¤¹å’Œ`pre-commit`é’©å­ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥åœ¨`pre-commit`é’©å­ä¸­æ·»åŠ è‡ªå·±çš„è„šæœ¬äº†ï¼Œæˆ–æ˜¯ä½¿ç”¨å…¶ä»–çš„é’©å­ã€‚

```sh
// highlight-next-line
.husky
â”œâ”€pre-commit
â””â”€_
```

```sh title=".husky/pre-commit" showLineNumbers
pnpm test

```

## æ·»åŠ `lint-staged`

[lint-staged](https://github.com/lint-staged/lint-staged#readme)æ˜¯ä¸€ä¸ªæµè¡Œçš„å·¥å…·ï¼Œé€šå¸¸ä¸`pre-commit`é’©å­ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºåœ¨æäº¤æ›´æ”¹åˆ°ä»£ç ä»“åº“ä¹‹å‰è‡ªåŠ¨è¿è¡Œlinterså’Œå…¶ä»–ä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ç¡®ä¿åªå¯¹æš‚å­˜çš„æ–‡ä»¶ï¼ˆå³é‚£äº›å·²ç»æ·»åŠ åˆ°Gitæš‚å­˜åŒºçš„æ–‡ä»¶ï¼‰è¿è¡Œè¿™äº›å·¥å…·ï¼Œä»è€ŒèŠ‚çœæ—¶é—´å¹¶åªå…³æ³¨é‚£äº›å³å°†æäº¤çš„æ›´æ”¹ã€‚

```sh
pnpm add --save-dev lint-staged
```

ç„¶ååœ¨`package.json`ä¸­æ·»åŠ `lint-staged`é…ç½®ã€‚

```json title="package.json" showLineNumbers
{
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": "eslint --fix",
    "*.{md,mdx}": "markdownlint --fix",
    // å¯¹äºå¤šæ¡æŒ‡ä»¤ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„æŒ‡å®š
    // highlight-start
    "src/**/*.{js,jsx,ts,tsx,vue}": ["prettier --write", "eslint --fix"]
    // highlight-end
  }
}
```

æœ€åä¿®æ”¹`pre-commit`é’©å­ï¼Œä»¥ä¾¿åœ¨æäº¤å‰è‡ªåŠ¨è§¦å‘ï¼Œè¿›è¡Œæ ¼å¼åŒ–å’Œlintã€‚

```sh title=".husky/pre-commit" showLineNumbers
pnpm test

```

## æ·»åŠ `commit-lint`

[commitlint](https://commitlint.js.org/guides/getting-started)ç”¨äºæ£€æŸ¥ Git æäº¤æ¶ˆæ¯æ˜¯å¦éµå¾ªé¢„å®šä¹‰çš„é£æ ¼æŒ‡å—ã€‚è¿™ä¸ªå·¥å…·éå¸¸æœ‰åŠ©äºç»´æŒé¡¹ç›®ä¸­æäº¤å†å²çš„æ¸…æ™°å’Œä¸€è‡´æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å›¢é˜Ÿç¯å¢ƒä¸­ï¼Œä¸åŒçš„å¼€å‘è€…å¯èƒ½ä¹ æƒ¯äºä½¿ç”¨ä¸åŒçš„æäº¤æ¶ˆæ¯æ ¼å¼ã€‚

```sh
pnpm add --save-dev @commitlint/cli @commitlint/config-conventional
```

å®‰è£…å®Œæˆåï¼Œåœ¨`package.json`åŒçº§ç›®å½•ä¸‹åˆ›å»º`commitlint.config.js`ä»¥é…ç½®`commitlint`ã€‚

```js title="commitlint.config.js"
export default { extends: ["@commitlint/config-conventional"] };
```

é…ç½®å®Œæˆåï¼Œéœ€è¦åœ¨`.husky`ç›®å½•ä¸‹æ–°å»º`commit-msg`é’©å­ï¼Œä»¥ä¾¿åœ¨æäº¤æ—¶è‡ªåŠ¨è§¦å‘`commitlint`ã€‚

```sh title=".husky/commit-msg" showLineNumbers
npx --no -- commitlint --edit ${1}

```
